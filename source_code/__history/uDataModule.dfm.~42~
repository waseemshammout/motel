object dm: Tdm
  Height = 480
  Width = 640
  object con: TFDConnection
    Params.Strings = (
      'Database=C:\Users\Waseem\Desktop\bates\db\db.sdb'
      'LockingMode=Normal'
      'DriverID=SQLite')
    Connected = True
    LoginPrompt = False
    Left = 32
    Top = 16
  end
  object InitiateSchema: TFDQuery
    Connection = con
    SQL.Strings = (
      'create table rooms'
      '(   '
      '    room_id integer primary key autoincrement,'
      '    room_number varchar(100) unique,'
      '    description varchar(100) unique,'
      '    standard_rate_per_night real,'
      '    beds integer,'
      '    max_capacity_guests integer,'
      '    has_kitchen boolean,'
      '    has_bath boolean,'
      '    has_fridge boolean,'
      '    has_safe boolean,'
      '    has_tv boolean,'
      
        '    room_status varchar(100) default '#39'OOS'#39' check (room_status in' +
        ' ('#39'Occupied'#39','#39'Vacant'#39','#39'OOS'#39')),'
      '    created_at timestamp default CURRENT_TIMESTAMP'
      ');'
      ''
      'create table guests'
      '('
      '    guest_id integer primary key autoincrement,'
      '    first_name varchar(100),'
      '    last_name varchar(100),'
      '    date_of_birth date,'
      '    birth_country varchar(100),'
      '    id_number varchar(100),'
      '    id_type varchar(100),'
      '    sex varchar(6) check (sex in ('#39'Male'#39', '#39'Female'#39')),'
      '    phone varchar(100),'
      '    email varchar(100),'
      '    guardian_id integer,'
      '    created_at timestamp default CURRENT_TIMESTAMP'
      ');'
      ''
      'create table bookings'
      '('
      '    booking_id integer primary key autoincrement,'
      '    booking_num varchar(100) unique,'
      '    checkin_date date,'
      '    checkout_date date,'
      '    nights int,'
      '    room_id integer references rooms (room_id),'
      '    rate_per_night real,'
      '    total_amount real,'
      
        '    status varchar(10) default '#39'Pending'#39' check (status in ('#39'Pend' +
        'ing'#39','#39'Confirmed'#39','#39'Checked-In'#39','#39'Checked-Out'#39','#39'Canceled'#39') ),'
      '    settled_amount real default 0,'
      '    created_at timestamp default CURRENT_TIMESTAMP'
      ');'
      ''
      'create table booking_guests_details'
      '('
      '    id integer primary key autoincrement,'
      '    booking_id integer references bookings (booking_id),'
      '    guest_id integer references guests (guest_id),'
      '    contact_guest boolean,'
      '    created_at timestamp default CURRENT_TIMESTAMP'
      ');'
      ''
      'create table payments'
      '('
      '    payment_id integer primary key autoincrement,'
      '    payment_num varchar(100) unique,'
      '    payment_date date,'
      
        '    payment_type varchar(100) check (payment_type in ('#39'Cash'#39', '#39'C' +
        'redit card'#39', '#39'Crypto'#39')),'
      '    amount real,'
      
        '    currency varchar(10) check (currency in ('#39'USD'#39', '#39'EUR'#39', '#39'GBP'#39 +
        ', '#39'BTC'#39', '#39'ETH'#39', '#39'USDC'#39', '#39'USDT'#39')),'
      
        '    booking_id integer not null references bookings (booking_id)' +
        ','
      '    created_at timestamp default CURRENT_TIMESTAMP'
      ');'
      ''
      'CREATE TRIGGER populate_booking_number'
      'AFTER INSERT ON bookings'
      'FOR EACH ROW'
      'BEGIN'
      '    UPDATE bookings'
      
        '    SET booking_num = '#39'BM-'#39' || strftime('#39'%Y%m'#39', NEW.created_at) ' +
        '|| '#39'-'#39' ||'
      
        '                         (SELECT COUNT(*) + 1 FROM bookings WHER' +
        'E strftime('#39'%Y%m'#39', created_at) = strftime('#39'%Y%m'#39', NEW.created_at' +
        '))'
      '    WHERE booking_id = NEW.booking_id;'
      'END;')
    Left = 32
    Top = 80
  end
  object FDQuery1: TFDQuery
    Connection = con
    SQL.Strings = (
      'select * from bookings;')
    Left = 304
    Top = 224
  end
end
